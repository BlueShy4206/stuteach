<?php
//...................................................................使用EAP
  //將能力區間切成34個點
  //echo "EAP</br>";
  $q_length = 34;
	$q_points = array(-3.4,-3.2,-3,-2.8,-2.6,-2.4,-2.2,-2,-1.8,-1.6,-1.4,-1.2,-1,-0.8,-0.6,-0.4,-0.2,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4);
	//每一個能力區間出現的機率值
  $q_pro = array(0.0004,0.0006,0.0013,0.0021,0.0035,0.0057,0.0089,0.0131,0.0189,0.026,0.0343,0.0436,0.0532,0.0624,0.0703,0.0761,0.0793,0.0793,0.0761,0.0703,0.0624,0.0532,0.0436,0.0343,0.026,0.0189,0.0131,0.0089,0.0057,0.0035,0.0021,0.0013,0.0006,0.0004);  
	//...................................................................EAP的函數
  function U($D = 1.702,$A_item,$B_item,$h_exam)   
  {   
    $U = pow((1+exp(-$D*$A_item*($h_exam-$B_item))),(-1));
    return $U;
  }
  //...................................................................function_P    2
  function P($C_item,$U) 
  {   
    $P = $C_item+(1-$C_item)*$U;
    return $P;
  }
  //...................................................................EAP主程式
  $h_exam_tmp = $h_exam;
  $D = 1.702;  
  $h_exam_u = 0;  //$h_exam的分子
  $h_exam_l = 0;  //$h_exam的分母
  for($k=0;$k<$q_length;$k++)
  {    
    $Xk = $q_points[$k];  //第i個能力點
    $W = $q_pro[$k];  //第i個能力點的出現機率
    $L_W = 0; 
    $L = 1;
    //求likelihood 
    for($i=0;$i<($select_num-1);$i++)
    {    
      $U = U($D,$A_item[$i],$B_item[$i],$Xk);  
      $P = P($C_item[$i],$U);  
      if($X_item[$i]==1)
      {
        $L = $L*$P;
      }
      else
      {
        $L = $L*(1-$P);
      }        
    }
    $L_W = $L*$W; 
    $L_W_0 = round($L_W,4);
    $h_exam_u = $h_exam_u+($Xk*$L_W);  
    $h_exam_l = $h_exam_l+$L_W;      
  }
  $h_exam = $h_exam_u/$h_exam_l;  
  $h_exam = round($h_exam,4);
  $_SESSION["h_exam_A"].=$h_exam._SPLIT_SYMBOL;
  $error_d = abs($h_exam-$h_exam_tmp);
  //...................................................................end 
?>
